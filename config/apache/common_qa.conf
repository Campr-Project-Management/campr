ServerAdmin info@campr.biz
DocumentRoot /var/www/qa.campr.biz/current/web

LogLevel warn
ErrorLog /var/www/qa.campr.biz/current/var/logs/error.log
CustomLog /var/www/qa.campr.biz/current/var/logs/access.log combined

DirectoryIndex app.php
Options +Indexes +FollowSymLinks +MultiViews -SymLinksIfOwnerMatch

<Directory "/var/www/qa.campr.biz/current/web">
    AuthType Basic
    AuthName "Authentication Required"
    AuthUserFile "/var/www/qa.campr.biz/current/config/apache/.htpasswd"
    Require expr "%{REQUEST_URI} =~ m#^/api/.*#"
    Require valid-user

    Order Deny,Allow
    Satisfy any
    Allow from all

    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /

        RewriteRule .*phpmyadmin.* - [R=404,L]

        RewriteCond %{HTTP:Authorization} ^(.*)
        RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]

        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^(.*)$ /app.php [QSA,L]
    </IfModule>

    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE text/javascript
        AddOutputFilterByType DEFLATE text/x-component
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/richtext
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/xsd
        AddOutputFilterByType DEFLATE text/xsl
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE application/x-javascript
        AddOutputFilterByType DEFLATE image/svg+xml
        AddOutputFilterByType DEFLATE image/x-icon
    </IfModule>
</Directory>

ProxyPass /wss/ ws://127.0.0.1:1558/

<Location "/mailcatcher/">
    AuthType Basic
    AuthName "Campr Mailcatcher"
    AuthUserFile "/var/www/qa.campr.biz/current/config/apache/.htpasswd"
    Require valid-user

    Order allow,deny
    Allow from all

    SetEnv no-gzip 1
    ProxyPass "http://127.0.0.1:1080/"
    ProxyPassReverse "http://127.0.0.1:1080/"
    AddOutputFilterByType SUBSTITUTE text/html text/javascript application/javascript
    Substitute "s|/assets/|/mailcatcher/assets/|i"
    Substitute "s|\"/messages|\"/mailcatcher/messages|i"
</Location>
