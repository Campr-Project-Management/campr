ServerAdmin info@pmtool.com
DocumentRoot /var/www/pmtool.com/current/web

LogLevel warn
ErrorLog /var/www/pmtool.com/current/var/logs/error.log
CustomLog /var/www/pmtool.com/current/var/logs/access.log combined

DirectoryIndex app.php
Options +Indexes +FollowSymLinks +MultiViews -SymLinksIfOwnerMatch

<Directory "/var/www/pmtool.com/current/web">
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /

        RewriteRule .*phpmyadmin.* - [R=404,L]

        RewriteCond %{HTTP:Authorization} ^(.*)
        RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]

        # add www and redirect to https
        RewriteCond %{HTTP_HOST} !^www\.
        RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]

        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^(.*)$ /app.php [QSA,L]
    </IfModule>

    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE text/javascript
        AddOutputFilterByType DEFLATE text/x-component
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/richtext
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/xsd
        AddOutputFilterByType DEFLATE text/xsl
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE application/x-javascript
        AddOutputFilterByType DEFLATE image/svg+xml
        AddOutputFilterByType DEFLATE image/x-icon
    </IfModule>
</Directory>

SSLEngine On

ProxyPass /wss/ ws://127.0.0.1:1558/
